<app-header></app-header>

<div class="search-container">
  <div class="container py-4">
    
    <!-- Search Header -->
    <div class="search-header mb-4">
      <div class="row align-items-center">
        <div class="col-12 col-lg-8">
          <div class="search-box">
            <div class="input-group input-group-lg">
              <span class="input-group-text">
                <i class="fas fa-search"></i>
              </span>
              <input 
                type="text" 
                class="form-control" 
                placeholder="Search for apps, games, and more..." 
                [(ngModel)]="searchTerm"
                (input)="onSearchInput()"
                autocomplete="off">
              <button 
                *ngIf="searchTerm" 
                class="btn btn-outline-secondary" 
                type="button"
                (click)="clearSearch()">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
        </div>
        <div class="col-12 col-lg-4 mt-3 mt-lg-0">
          <div class="search-filters">
            <select 
              class="form-select" 
              [(ngModel)]="selectedCategoryId"
              (change)="onCategoryChange()">
              <option value="">All Categories</option>
              <option *ngFor="let category of categories" [value]="category.id">
                {{ category.name }}
              </option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Search Suggestions (when no search term) -->
    <div *ngIf="!searchTerm && !hasSearched" class="search-suggestions">
      
      <!-- Recent Searches -->
      <div *ngIf="recentSearches.length > 0" class="recent-searches mb-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">Recent Searches</h5>
          <button class="btn btn-link btn-sm text-muted" (click)="clearRecentSearches()">
            Clear All
          </button>
        </div>
        <div class="suggestions-list">
          <button 
            *ngFor="let search of recentSearches" 
            class="suggestion-item"
            (click)="searchRecentTerm(search)">
            <i class="fas fa-history"></i>
            {{ search }}
          </button>
        </div>
      </div>

      <!-- Trending Searches -->
      <div class="trending-searches mb-4">
        <h5 class="mb-3">Trending Searches</h5>
        <div class="suggestions-list">
          <button 
            *ngFor="let trending of trendingSearches" 
            class="suggestion-item trending"
            (click)="searchTrendingTerm(trending)">
            <i class="fas fa-fire"></i>
            {{ trending }}
          </button>
        </div>
      </div>

      <!-- Popular Categories -->
      <div class="popular-categories">
        <h5 class="mb-3">Browse Popular Categories</h5>
        <div class="row g-3">
          <div *ngFor="let category of categories.slice(0, 8)" class="col-6 col-md-3">
            <div class="category-quick-link" [routerLink]="['/categories', category.id]">
              <div class="category-icon" [style.background-color]="category.color">
                <i [class]="category.icon"></i>
              </div>
              <span class="category-name">{{ category.name }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Searching...</span>
      </div>
      <p class="mt-3 text-muted">Searching for "{{ searchTerm }}"...</p>
    </div>

    <!-- Search Results -->
    <div *ngIf="!loading && hasSearched" class="search-results">
      
      <!-- Results Header -->
      <div class="results-header mb-4">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
          <div class="results-info">
            <h4 class="mb-1">Search Results</h4>
            <p class="text-muted mb-0">
              Found {{ searchResults.length }} apps
              <span *ngIf="searchTerm"> for "{{ searchTerm }}"</span>
              <span *ngIf="selectedCategoryId"> in {{ getCategoryName(selectedCategoryId) }}</span>
            </p>
          </div>
          <div class="results-controls d-flex gap-2">
            <!-- Sort Dropdown -->
            <select 
              class="form-select form-select-sm" 
              [(ngModel)]="sortBy"
              (change)="onSortChange()">
              <option value="relevance">Relevance</option>
              <option value="rating">Highest Rated</option>
              <option value="downloads">Most Downloaded</option>
              <option value="newest">Newest</option>
              <option value="name">Name A-Z</option>
            </select>
            
            <!-- View Mode Toggle -->
            <div class="btn-group" role="group">
              <button 
                type="button" 
                class="btn btn-outline-secondary btn-sm"
                [class.active]="viewMode === 'grid'"
                (click)="viewMode = 'grid'">
                <i class="fas fa-th"></i>
              </button>
              <button 
                type="button" 
                class="btn btn-outline-secondary btn-sm"
                [class.active]="viewMode === 'list'"
                (click)="viewMode = 'list'">
                <i class="fas fa-list"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Grid View -->
      <div *ngIf="viewMode === 'grid'" class="results-grid">
        <div class="row g-4">
          <div *ngFor="let app of searchResults" class="col-12 col-sm-6 col-md-4 col-lg-3">
            <div class="app-card" (click)="viewAppDetails(app.id!)">
              <div class="app-icon">
                <img [ngSrc]="app.iconThumbUrl || app.iconUrl" 
                     [alt]="app.name" 
                     class="img-fluid"
                     width="80" 
                     height="80"
                     [placeholder]="app.iconThumbUrl || app.iconUrl">
              </div>
              <div class="app-info">
                <h6 class="app-name">{{ app.name }}</h6>
                <p class="app-publisher text-muted">{{ app.publisher }}</p>
                <div class="app-rating">
                  <div class="stars">
                    <i *ngFor="let star of getStarArray(app.rating)" 
                       class="fas fa-star"
                       [class.filled]="star === 1"></i>
                  </div>
                  <span class="rating-text">({{ app.reviewsCount }})</span>
                </div>
                <div class="app-stats">
                  <span class="downloads">{{ formatDownloadCount(app.downloads) }} downloads</span>
                </div>
              </div>
              <div class="app-actions">
                <button class="btn btn-primary btn-sm" (click)="downloadApp(app, $event)">
                  <i class="fas fa-download"></i> Install
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- List View -->
      <div *ngIf="viewMode === 'list'" class="results-list">
        <div *ngFor="let app of searchResults" class="app-list-item" (click)="viewAppDetails(app.id!)">
          <div class="app-icon">
            <img [ngSrc]="app.iconThumbUrl || app.iconUrl" 
                 [alt]="app.name" 
                 class="img-fluid"
                 width="60" 
                 height="60"
                 [placeholder]="app.iconThumbUrl || app.iconUrl">
          </div>
          <div class="app-info flex-grow-1">
            <h6 class="app-name mb-1">{{ app.name }}</h6>
            <p class="app-publisher text-muted mb-1">{{ app.publisher }}</p>
            <p class="app-description text-muted mb-2">{{ app.description | slice:0:120 }}{{ app.description.length > 120 ? '...' : '' }}</p>
            <div class="app-meta d-flex align-items-center">
              <div class="app-rating me-3">
                <div class="stars">
                  <i *ngFor="let star of getStarArray(app.rating)" 
                     class="fas fa-star"
                     [class.filled]="star === 1"></i>
                </div>
                <span class="rating-text">({{ app.reviewsCount }})</span>
              </div>
              <span class="downloads text-muted me-3">{{ formatDownloadCount(app.downloads) }} downloads</span>
              <span class="category badge bg-light text-dark">{{ app.category }}</span>
            </div>
          </div>
          <div class="app-actions">
            <div class="app-size text-muted mb-2">{{ app.size }}</div>
            <button class="btn btn-primary" (click)="downloadApp(app, $event)">
              <i class="fas fa-download"></i> Install
            </button>
          </div>
        </div>
      </div>

      <!-- No Results -->
      <div *ngIf="searchResults.length === 0" class="no-results text-center py-5">
        <i class="fas fa-search fa-4x text-muted mb-3"></i>
        <h4>No Results Found</h4>
        <p class="text-muted mb-4">
          We couldn't find any apps matching "{{ searchTerm }}"
          <span *ngIf="selectedCategoryId"> in {{ getCategoryName(selectedCategoryId) }}</span>.
        </p>
        <div class="suggestions">
          <p class="mb-3">Try:</p>
          <ul class="list-unstyled">
            <li>• Checking your spelling</li>
            <li>• Using different keywords</li>
            <li>• Searching in all categories</li>
            <li>• Browsing popular categories below</li>
          </ul>
          <button class="btn btn-primary mt-3" (click)="clearSearch()">
            <i class="fas fa-home"></i> Browse All Apps
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<app-footer></app-footer>
