<div class="dashboard-home">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container d-flex justify-content-center align-items-center" style="min-height: 400px;">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="alert alert-danger text-center">
    <i class="bi bi-exclamation-triangle me-2"></i>
    {{ error }}
    <button class="btn btn-outline-danger btn-sm ms-3" (click)="retryLoad()">
      <i class="bi bi-arrow-clockwise me-1"></i>
      Retry
    </button>
  </div>

  <!-- Main Content -->
  <ng-container *ngIf="!isLoading && !error">
    <!-- Welcome Hero Section -->
    <div class="hero-section mb-5">
      <div class="container-fluid">
        <div class="hero-content" [@fadeInUp]>
          <div class="hero-text">
            <h1 class="hero-title">Welcome back, <span class="text-gradient">Developer</span>! ðŸ‘‹</h1>
            <p class="hero-subtitle">Ready to build something amazing? Here's your development overview.</p>
            <div class="hero-actions mt-4">
              <button 
                mat-raised-button 
                color="primary" 
                class="hero-btn primary" 
                routerLink="/developer-dashboard/add-app"
                (click)="onCreateApp()"
                matRipple>
                <i class="bi bi-plus-circle me-2"></i>
                Create New App
              </button>
              <button 
                mat-stroked-button 
                class="hero-btn secondary ms-3" 
                routerLink="/developer-dashboard/list"
                (click)="onManageApps()"
                matRipple>
                <i class="bi bi-list-ul me-2"></i>
                Manage Apps
              </button>
              
              <!-- Admin Rating Operations -->
              <div class="admin-operations mt-3 pt-3 border-top">
                <small class="text-muted d-block mb-2">Admin Operations</small>
                <button 
                  mat-stroked-button 
                  color="accent"
                  class="admin-btn me-2" 
                  (click)="recalculateAllRatings()"
                  [disabled]="isRecalculatingRatings"
                  matRipple>
                  <i class="bi bi-arrow-clockwise me-1" [class.spin]="isRecalculatingRatings"></i>
                  {{ isRecalculatingRatings ? 'Recalculating...' : 'Recalculate All Ratings' }}
                </button>
                <button 
                  mat-stroked-button 
                  color="warn"
                  class="admin-btn" 
                  (click)="fixStaticRatings()"
                  [disabled]="isRecalculatingRatings"
                  matRipple>
                  <i class="bi bi-tools me-1"></i>
                  Fix Static Ratings
                </button>
              </div>

              <!-- Store APK Management -->
              <div class="store-apk-section mt-3 pt-3 border-top">
                <small class="text-muted d-block mb-2">Solidev Store APK</small>
                <div class="apk-management-card">
                  <div class="apk-current" *ngIf="storeApkUrl">
                    <div class="apk-info">
                      <i class="bi bi-android2 text-success me-2"></i>
                      <span class="text-muted">Current APK URL:</span>
                    </div>
                    <div class="apk-url-container">
                      <input 
                        type="text" 
                        class="form-control form-control-sm apk-url-input" 
                        [value]="storeApkUrl" 
                        readonly>
                      <button 
                        mat-icon-button 
                        (click)="copyApkUrl()"
                        matTooltip="Copy URL"
                        class="copy-btn">
                        <i class="bi bi-clipboard"></i>
                      </button>
                    </div>
                  </div>

                  <div class="apk-upload mt-3">
                    <div class="upload-container">
                      <input 
                        type="file" 
                        accept=".apk"
                        (change)="onStoreApkFileSelected($event)"
                        #apkFileInput
                        style="display: none;">
                      
                      <button 
                        mat-stroked-button 
                        color="primary"
                        (click)="apkFileInput.click()"
                        [disabled]="isUploadingApk"
                        class="me-2">
                        <i class="bi bi-folder2-open me-1"></i>
                        Select APK
                      </button>

                      <button 
                        mat-raised-button 
                        color="primary"
                        (click)="uploadStoreApk()"
                        [disabled]="!storeApkFile || isUploadingApk">
                        <mat-spinner 
                          *ngIf="isUploadingApk" 
                          diameter="16" 
                          class="me-1"
                          style="display: inline-block; vertical-align: middle;"></mat-spinner>
                        <i *ngIf="!isUploadingApk" class="bi bi-cloud-upload me-1"></i>
                        {{ isUploadingApk ? 'Uploading...' : 'Upload APK' }}
                      </button>

                      <span *ngIf="storeApkFile" class="ms-3 text-muted">
                        <i class="bi bi-file-earmark-check text-success me-1"></i>
                        {{ storeApkFile.name }}
                      </span>
                    </div>

                    <mat-progress-bar 
                      *ngIf="isUploadingApk" 
                      mode="determinate" 
                      [value]="apkUploadProgress"
                      class="mt-2"></mat-progress-bar>
                    
                    <small class="text-muted d-block mt-2">
                      <i class="bi bi-info-circle me-1"></i>
                      This APK will be used for the install prompt and download links throughout the app.
                    </small>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="hero-visual">
            <div 
              class="floating-card card-1" 
              matTooltip="Total Published Apps"
              (mouseenter)="onCardHover('apps')">
              <i class="bi bi-app"></i>
              <span>{{ totalApps }}</span>
            </div>
            <div 
              class="floating-card card-2" 
              matTooltip="Total Downloads"
              (mouseenter)="onCardHover('downloads')">
              <i class="bi bi-download"></i>
              <span>{{ totalDownloads }}</span>
            </div>
            <div 
              class="floating-card card-3" 
              matTooltip="Average Rating"
              (mouseenter)="onCardHover('rating')">
              <i class="bi bi-star-fill"></i>
              <span>{{ averageRating }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

  <!-- Key Metrics Dashboard -->
  <div class="metrics-section mb-5">
    <div class="container-fluid">
      <div class="section-header mb-4">
        <h3 class="section-title">ðŸ“Š Performance Overview</h3>
        <p class="section-subtitle">Track your app success metrics at a glance</p>
      </div>
      
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-icon bg-primary">
              <i class="bi bi-app"></i>
            </div>
            <div class="metric-trend positive">
              <i class="bi bi-arrow-up"></i>
              <span>+{{ newAppsThisMonth }}</span>
            </div>
          </div>
          <div class="metric-content">
            <h3 class="metric-number">{{ totalApps }}</h3>
            <p class="metric-label">Published Apps</p>
            <div class="metric-progress">
              <mat-progress-bar mode="determinate" [value]="75" color="primary"></mat-progress-bar>
              <small class="progress-text">75% of monthly goal</small>
            </div>
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-icon bg-success">
              <i class="bi bi-download"></i>
            </div>
            <div class="metric-trend positive">
              <i class="bi bi-arrow-up"></i>
              <span>+18%</span>
            </div>
          </div>
          <div class="metric-content">
            <h3 class="metric-number">{{ totalDownloads }}</h3>
            <p class="metric-label">Total Downloads</p>
            <div class="metric-progress">
              <mat-progress-bar mode="determinate" [value]="85" color="accent"></mat-progress-bar>
              <small class="progress-text">Exceeding expectations!</small>
            </div>
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-icon bg-warning">
              <i class="bi bi-star-fill"></i>
            </div>
            <div class="metric-trend positive">
              <i class="bi bi-arrow-up"></i>
              <span>+0.3</span>
            </div>
          </div>
          <div class="metric-content">
            <h3 class="metric-number">{{ averageRating }}</h3>
            <p class="metric-label">Average Rating</p>
            <div class="rating-stars">
              <i class="bi bi-star-fill" *ngFor="let star of [1,2,3,4]"></i>
              <i class="bi bi-star-half"></i>
              <small class="ms-2">({{ totalReviews }} reviews)</small>
            </div>
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-icon bg-info">
              <i class="bi bi-currency-dollar"></i>
            </div>
            <div class="metric-trend positive">
              <i class="bi bi-arrow-up"></i>
              <span>+32%</span>
            </div>
          </div>
          <div class="metric-content">
            <h3 class="metric-number">${{ monthlyRevenue }}</h3>
            <p class="metric-label">Monthly Revenue</p>
            <div class="revenue-chart">
              <div class="chart-bars">
                <div class="bar" style="height: 40%"></div>
                <div class="bar" style="height: 65%"></div>
                <div class="bar" style="height: 85%"></div>
                <div class="bar" style="height: 100%"></div>
              </div>
              <small class="chart-text">Last 4 months trend</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Apps & Activity -->
  <div class="content-section">
    <div class="container-fluid">
      <div class="row g-4">
      <!-- Recent Apps -->
      <div class="col-12 col-lg-7">
        <div class="content-card">
          <div class="card-header">
            <div class="header-left">
              <h5 class="card-title">ðŸš€ Recent Apps</h5>
              <p class="card-subtitle">Your latest published applications</p>
            </div>
            <button mat-button class="view-all-btn" routerLink="/developer-dashboard/list">
              View All
              <i class="bi bi-arrow-right ms-1"></i>
            </button>
          </div>
          <div class="card-body">
            <div class="apps-list" *ngIf="recentApps.length > 0; else noApps">
              <div class="app-item" *ngFor="let app of recentApps; let i = index">
                <div class="app-info">
                  <div class="app-icon">
                    <img [ngSrc]="app.iconUrl" 
                         [alt]="app.name" 
                         width="40" 
                         height="40"
                         [placeholder]="app.iconUrl"
                         onerror="this.style.display='none'">
                    <i class="bi bi-app fallback-icon" *ngIf="!app.iconUrl"></i>
                  </div>
                  <div class="app-details">
                    <h6 class="app-name">{{ app.name }}</h6>
                    <p class="app-category">{{ app.category }}</p>
                  </div>
                </div>
                <div class="app-stats">
                  <div class="stat-item">
                    <i class="bi bi-download text-success"></i>
                    <span>{{ getAppDownloads(app) }}</span>
                  </div>
                  <div class="stat-item">
                    <i class="bi bi-star-fill text-warning"></i>
                    <span>{{ app.rating || '0.0' }}</span>
                  </div>
                </div>
                <div class="app-actions">
                  <button mat-icon-button class="action-btn" routerLink="/developer-dashboard/add-app" [queryParams]="{id: app.id}">
                    <i class="bi bi-pencil"></i>
                  </button>
                </div>
              </div>
            </div>
            <ng-template #noApps>
              <div class="empty-state text-center py-4">
                <i class="bi bi-app-indicator display-4 text-muted mb-3"></i>
                <h6 class="text-muted">No apps yet</h6>
                <p class="text-muted small">Create your first app to get started!</p>
              </div>
            </ng-template>
          </div>
        </div>
      </div>

      <!-- Activity Feed -->
      <div class="col-12 col-lg-5">
        <div class="content-card">
          <div class="card-header">
            <div class="header-left">
              <h5 class="card-title">ðŸ“ˆ Activity Feed</h5>
              <p class="card-subtitle">Recent updates and milestones</p>
            </div>
            <div class="activity-indicator">
              <span class="indicator-dot"></span>
              <small>Live</small>
            </div>
          </div>
          <div class="card-body">
            <div class="activity-timeline">
              <div class="timeline-item">
                <div class="timeline-icon bg-success">
                  <i class="bi bi-check-circle"></i>
                </div>
                <div class="timeline-content">
                  <h6 class="timeline-title">App Published Successfully</h6>
                  <p class="timeline-text">{{ (recentApps && recentApps[0]) ? recentApps[0].name : 'PhotoEditor Pro' }} is now live in the store</p>
                  <small class="timeline-time">2 hours ago</small>
                </div>
              </div>
              
              <div class="timeline-item">
                <div class="timeline-icon bg-info">
                  <i class="bi bi-star"></i>
                </div>
                <div class="timeline-content">
                  <h6 class="timeline-title">New 5-Star Review</h6>
                  <p class="timeline-text">"Amazing app! Exactly what I needed for my daily tasks."</p>
                  <small class="timeline-time">5 hours ago</small>
                </div>
              </div>
              
              <div class="timeline-item">
                <div class="timeline-icon bg-primary">
                  <i class="bi bi-download"></i>
                </div>
                <div class="timeline-content">
                  <h6 class="timeline-title">Milestone Reached</h6>
                  <p class="timeline-text">MusicPlayer hit 1,000 downloads!</p>
                  <small class="timeline-time">1 day ago</small>
                </div>
              </div>
              
              <div class="timeline-item">
                <div class="timeline-icon bg-warning">
                  <i class="bi bi-exclamation-triangle"></i>
                </div>
                <div class="timeline-content">
                  <h6 class="timeline-title">Action Required</h6>
                  <p class="timeline-text">Update required for GameHub compatibility</p>
                  <small class="timeline-time">2 days ago</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions Panel -->
  <div class="actions-section mt-5">
    <div class="container-fluid">
      <div class="section-header mb-4">
        <h3 class="section-title">âš¡ Quick Actions</h3>
        <p class="section-subtitle">Frequently used developer tools and shortcuts</p>
      </div>
      
      <div class="actions-grid">
        <div class="action-card" routerLink="/developer-dashboard/add-app">
          <div class="action-icon bg-primary">
            <i class="bi bi-plus-circle"></i>
          </div>
          <h6 class="action-title">Create App</h6>
          <p class="action-description">Start building your next amazing application</p>
        </div>
        
        <div class="action-card" routerLink="/developer-dashboard/list">
          <div class="action-icon bg-success">
            <i class="bi bi-list-ul"></i>
          </div>
          <h6 class="action-title">Manage Apps</h6>
          <p class="action-description">Edit, update, or remove existing apps</p>
        </div>
        
        <div class="action-card">
          <div class="action-icon bg-info">
            <i class="bi bi-graph-up"></i>
          </div>
          <h6 class="action-title">Analytics</h6>
          <p class="action-description">View detailed performance metrics</p>
        </div>
        
        <div class="action-card">
          <div class="action-icon bg-warning">
            <i class="bi bi-gear"></i>
          </div>
          <h6 class="action-title">Settings</h6>
          <p class="action-description">Configure your developer preferences</p>
        </div>
        
        <div class="action-card">
          <div class="action-icon bg-secondary">
            <i class="bi bi-question-circle"></i>
          </div>
          <h6 class="action-title">Documentation</h6>
          <p class="action-description">Access developer guides and API docs</p>
        </div>
        
        <div class="action-card">
          <div class="action-icon bg-danger">
            <i class="bi bi-bug"></i>
          </div>
          <h6 class="action-title">Report Issue</h6>
          <p class="action-description">Submit bugs or feature requests</p>
        </div>
      </div>
    </div>
  </div>
</div>
