<div class="apps-list-container">
  <!-- Header Section -->
  <div class="header-section mb-4">
    <div class="d-flex justify-content-between align-items-center">
      <div class="page-title">
        <h2 class="mb-1 fw-bold text-dark">My Apps</h2>
        <p class="text-muted mb-0">Manage and monitor your published applications</p>
      </div>
      <button mat-raised-button color="primary" (click)="addApp()" class="add-app-btn">
        <mat-icon>add_circle_outline</mat-icon>
        <span class="ms-2">Add New App</span>
      </button>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-section mb-4">
    <div class="row g-3">
            <div class="col-12 col-md-3">
        <div class="stat-card">
          <div class="stat-icon bg-primary">
            <i class="bi bi-collection"></i>
          </div>
          <div class="stat-content">
            <h4 class="stat-number">{{ totalApps }}</h4>
            <p class="stat-label">Total Apps</p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-3">
        <div class="stat-card">
          <div class="stat-icon bg-success">
            <i class="bi bi-download"></i>
          </div>
          <div class="stat-content">
            <h4 class="stat-number">{{ getFormattedDownloads() }}</h4>
            <p class="stat-label">Downloads</p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-3">
        <div class="stat-card">
          <div class="stat-icon bg-info">
            <i class="bi bi-star-fill"></i>
          </div>
          <div class="stat-content">
            <h4 class="stat-number">{{ getFormattedRating() }}</h4>
            <p class="stat-label">Avg Rating</p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-3">
        <div class="stat-card">
          <div class="stat-icon bg-warning">
            <i class="bi bi-currency-dollar"></i>
          </div>
          <div class="stat-content">
            <h4 class="stat-number">{{ getFormattedRevenue() }}</h4>
            <p class="stat-label">Revenue</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Apps Table -->
  <div class="table-container">
    <div class="table-header p-3 border-bottom d-flex justify-content-between align-items-center">
      <h5 class="mb-0 fw-semibold">Applications</h5>
      <div class="d-flex gap-2">
        <button 
          mat-stroked-button 
          color="accent"
          (click)="recalculateRatingsForAllApps()"
          [disabled]="isRecalculatingRatings"
          class="btn-sm">
          <mat-icon>refresh</mat-icon>
          {{ isRecalculatingRatings ? 'Updating...' : 'Update Ratings' }}
        </button>
        <button mat-raised-button color="primary" (click)="addApp()" class="btn-sm">
          <mat-icon>add</mat-icon>
          Add App
        </button>
      </div>
    </div>
    
    <div class="table-responsive">
      <table mat-table [dataSource]="apps" class="apps-table w-100">
        <!-- Icon Column -->
        <ng-container matColumnDef="icon">
          <th mat-header-cell *matHeaderCellDef class="icon-column">App</th>
          <td mat-cell *matCellDef="let app" class="icon-column">
            <div class="app-info d-flex align-items-center">
              <div class="app-icon-wrapper me-3">
                <img [ngSrc]="app.iconUrl" 
                     alt="icon" 
                     class="app-icon"
                     width="48" 
                     height="48"
                     [placeholder]="app.iconUrl">
              </div>
              <div class="app-details">
                <div class="app-name fw-semibold">{{ app.name }}</div>
                <small class="text-muted">{{ app.category }}</small>
              </div>
            </div>
          </td>
        </ng-container>

        <!-- Name Column (Hidden as info is now in icon column) -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let app">
            <span class="badge bg-success rounded-pill">Active</span>
          </td>
        </ng-container>

        <!-- Category Column -->
        <ng-container matColumnDef="category">
          <th mat-header-cell *matHeaderCellDef>Downloads</th>
          <td mat-cell *matCellDef="let app">
            <div class="downloads-info">
              <div class="fw-semibold">{{ getAppDownloads(app) }}</div>
              <small class="text-muted">{{ app.category }}</small>
            </div>
          </td>
        </ng-container>

        <!-- Rating Column -->
        <ng-container matColumnDef="rating">
          <th mat-header-cell *matHeaderCellDef>Rating</th>
          <td mat-cell *matCellDef="let app">
            <div class="rating-display d-flex align-items-center">
              <i class="bi bi-star-fill text-warning me-1"></i>
              <span class="fw-semibold">{{ app.rating || '0.0' }}</span>
              <small class="text-muted ms-1">({{ getReviewsCount(app) }})</small>
            </div>
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let app">
            <div class="actions-group d-flex gap-2">
              <button mat-icon-button class="action-btn edit-btn" (click)="editApp(app)" title="Edit App">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button class="action-btn view-btn" title="View Details">
                <mat-icon>visibility</mat-icon>
              </button>
              <button mat-icon-button class="action-btn delete-btn" (click)="deleteApp(app)" title="Delete App">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
      </table>
    </div>

    <!-- Empty State -->
    <div *ngIf="apps.length === 0" class="empty-state text-center py-5">
      <div class="empty-icon mb-3">
        <i class="bi bi-app-indicator display-1 text-muted"></i>
      </div>
      <h4 class="text-muted">No Apps Yet</h4>
      <p class="text-muted">Start by creating your first application</p>
      <button mat-raised-button color="primary" (click)="addApp()">
        <mat-icon>add</mat-icon>
        Create First App
      </button>
    </div>
  </div>
</div>
